# Railway Template Publishing Guide

This document explains how to publish this OpenClaw + Tailscale template on Railway's template marketplace.

---

## Prerequisites

1. **GitHub Repository**: This repo must be public
2. **Railway Account**: Sign up at [railway.app](https://railway.app)
3. **Test Deployment**: Verify template works end-to-end

---

## Template Structure

Our template includes:

```
âœ… railway.json         # Template metadata (variables, volumes, health checks)
âœ… railway.toml         # Build configuration
âœ… Dockerfile           # Container definition
âœ… entrypoint.sh        # Startup script
âœ… README.md            # User-facing documentation
âœ… /data volume         # Persistent storage for Tailscale + OpenClaw state
```

---

## Publishing Steps

### 1. Verify `railway.json`

Ensure `railway.json` is valid:

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "numReplicas": 1,
    "restartPolicyType": "ON_FAILURE",
    "healthcheckPath": "/setup/healthz",
    "healthcheckTimeout": 300
  },
  "volumes": [
    {
      "name": "data",
      "mountPath": "/data"
    }
  ],
  "environments": {
    "production": {
      "variables": {
        "SETUP_PASSWORD": { "required": true, "generator": { "type": "secret" } },
        "TAILSCALE_AUTHKEY": { "required": false, "isSecret": true },
        ...
      }
    }
  }
}
```

### 2. Test Local Deployment

```bash
# Build container
docker build -t openclaw-tailscale .

# Test without Tailscale
docker run --rm -p 8080:8080 \
  -e SETUP_PASSWORD=test \
  -e OPENCLAW_STATE_DIR=/data/.openclaw \
  -e OPENCLAW_WORKSPACE_DIR=/data/workspace \
  -v $(pwd)/.tmpdata:/data \
  openclaw-tailscale

# Test with Tailscale
docker run --rm -p 8080:8080 \
  -e SETUP_PASSWORD=test \
  -e TAILSCALE_AUTHKEY=tskey-auth-xxxxx \
  -e ENABLE_TAILSCALE_SERVE=true \
  -e OPENCLAW_STATE_DIR=/data/.openclaw \
  -e OPENCLAW_WORKSPACE_DIR=/data/workspace \
  -v $(pwd)/.tmpdata:/data \
  openclaw-tailscale
```

**Verify:**
- âœ… Container starts without errors
- âœ… `/setup/healthz` returns `{"ok":true}`
- âœ… Tailscale connects to tailnet (check logs)
- âœ… Setup wizard accessible at `/setup`

### 3. Deploy to Railway (Private Test)

1. Go to [railway.app/new](https://railway.app/new)
2. Select **Deploy from GitHub repo**
3. Connect this repository
4. Railway auto-detects `railway.json` and creates the service
5. Set required variables:
   - `SETUP_PASSWORD` (auto-generated)
   - `TAILSCALE_AUTHKEY` (optional, from your Tailscale admin)
6. Wait for deployment (~2 minutes)
7. Check logs for successful startup

**Expected logs:**

```
[tailscale] Starting Tailscale daemon...
[tailscale] Using auth key: tskey-auth-x...xxxx
[tailscale] tailscaled started (PID: 42)
[tailscale] Waiting for socket... (1s)
[tailscale] âœ“ Socket ready: /var/run/tailscale/tailscaled.sock
[tailscale] Authenticating with Tailscale...
[tailscale] âœ“ Connected to tailnet
[tailscale] âœ“ Tailnet-only access enabled
[tailscale] Access via: http://openclaw-railway.<tailnet>.ts.net:8080
[openclaw] Starting OpenClaw wrapper on port 8080...
```

### 4. Submit to Railway Template Marketplace

#### Option A: Via Railway Dashboard

1. Go to your deployed project
2. Click **Settings** â†’ **Template**
3. Click **Publish as Template**
4. Fill in template details:
   - **Name**: `OpenClaw + Tailscale`
   - **Description**: `Deploy OpenClaw AI assistant with Tailscale integration. Private, secure, zero-config setup.`
   - **Category**: `AI/ML` or `Productivity`
   - **Icon**: Upload OpenClaw/Tailscale logo
   - **README**: Link to this repo's README.md
5. Submit for review

#### Option B: Via Railway CLI

```bash
# Install Railway CLI
npm i -g @railway/cli

# Login
railway login

# Link to project
railway link

# Publish template
railway template publish
```

### 5. Template Metadata (railway.json)

Railway reads variables from `railway.json`. Ensure all required variables are documented:

| Variable | Required | Has Default | Generator | Notes |
|----------|----------|-------------|-----------|-------|
| `SETUP_PASSWORD` | âœ… Yes | No | `secret` (32 chars) | Auto-generated by Railway |
| `TAILSCALE_AUTHKEY` | âŒ No | No | N/A | User must get from Tailscale admin |
| `TAILSCALE_HOSTNAME` | âŒ No | `openclaw-railway` | N/A | Custom hostname |
| `ENABLE_TAILSCALE_SERVE` | âŒ No | `false` | N/A | Enable HTTPS reverse proxy |
| `OPENCLAW_STATE_DIR` | âŒ No | `/data/.openclaw` | N/A | Config directory |
| `OPENCLAW_WORKSPACE_DIR` | âŒ No | `/data/workspace` | N/A | Workspace directory |

---

## Volume Configuration

Railway must create a persistent volume at `/data`:

```json
"volumes": [
  {
    "name": "data",
    "mountPath": "/data"
  }
]
```

**Contents persisted:**
- `/data/.openclaw/openclaw.json` - OpenClaw configuration
- `/data/.openclaw/gateway.token` - Gateway auth token
- `/data/tailscale/state` - Tailscale connection state
- `/data/workspace/` - OpenClaw agent workspace
- `/data/.linuxbrew/` - Homebrew packages

**Why persistent?**
- Prevents re-onboarding after redeploy
- Keeps Tailscale node identity stable
- Preserves user credentials and AI model configs

---

## Health Check

Railway polls `/setup/healthz` every 30s (configured in `railway.json`).

**Endpoint:** `GET /setup/healthz`

**Response:**
```json
{
  "ok": true
}
```

**Located in:** `src/server.js:301`

```javascript
app.get("/setup/healthz", (_req, res) => res.json({ ok: true }));
```

---

## Deploy Button (README)

Add to README.md:

```markdown
[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/openclaw-tailscale)
```

**Note:** Replace `openclaw-tailscale` with your actual template slug after publishing.

---

## Template Testing Checklist

Before publishing, verify:

### Basic Functionality
- [ ] Container builds successfully
- [ ] Health check passes (`/setup/healthz` returns 200 OK)
- [ ] Setup wizard loads at `/setup`
- [ ] OpenClaw onboarding completes
- [ ] Gateway starts and proxies traffic
- [ ] Volume persists data across redeploys

### Tailscale Integration
- [ ] Tailscale disabled by default (no `TAILSCALE_AUTHKEY`)
- [ ] Tailscale connects when `TAILSCALE_AUTHKEY` is set
- [ ] Socket waiting loop works (max 30s)
- [ ] `tailscale status` shows connected node
- [ ] MagicDNS hostname resolves (e.g., `openclaw-railway.tail-xxxxx.ts.net`)
- [ ] Tailscale Serve works when `ENABLE_TAILSCALE_SERVE=true`
- [ ] Auth key is masked in logs (shows `tskey-auth-xxxx...yyyy`)

### Environment Variables
- [ ] All variables documented in README
- [ ] Defaults work without user input (except `SETUP_PASSWORD`)
- [ ] Secrets (`TAILSCALE_AUTHKEY`) marked as `isSecret: true` in `railway.json`
- [ ] `SETUP_PASSWORD` auto-generated by Railway

### Security
- [ ] `accept-dns=false` by default (prevents DNS hijacking)
- [ ] `ENABLE_TAILSCALE_SERVE=false` by default (opt-in for HTTPS)
- [ ] Auth keys never logged in plaintext
- [ ] Setup wizard protected by `SETUP_PASSWORD`
- [ ] Web TUI disabled by default (`ENABLE_WEB_TUI=false`)

### Documentation
- [ ] README has Deploy on Railway button
- [ ] Tailscale setup instructions clear
- [ ] Environment variables table complete
- [ ] Troubleshooting section covers common issues
- [ ] FAQ answers key questions

### Edge Cases
- [ ] Works without public networking (Tailscale-only)
- [ ] Handles tailscaled daemon failures gracefully (exits with error)
- [ ] Survives container restarts (volume preserves state)
- [ ] Multiple redeploys don't break Tailscale (reusable auth key)

---

## Post-Publish Checklist

After template is live on Railway:

1. **Update README.md** with correct template URL:
   ```markdown
   [![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/YOUR-TEMPLATE-ID)
   ```

2. **Test 1-click deploy** from template page:
   - Click deploy button
   - Verify variables pre-populated
   - Check logs for successful startup

3. **Monitor Railway Station** for user feedback:
   - [Railway Community Templates](https://railway.app/templates)
   - Respond to issues/questions

4. **Keep template updated**:
   - Watch for OpenClaw releases
   - Update Dockerfile with new versions
   - Test before pushing updates

---

## Common Issues During Publishing

### "Health check failing"

**Fix:** Ensure `/setup/healthz` endpoint exists and returns 200 OK:
```bash
curl http://localhost:8080/setup/healthz
# Should return: {"ok":true}
```

### "Volume not mounted"

**Fix:** Check `railway.json` has volume configuration:
```json
"volumes": [
  { "name": "data", "mountPath": "/data" }
]
```

### "Variables not showing in Railway dashboard"

**Fix:** Ensure `railway.json` has `environments.production.variables` defined.

### "Container exits immediately"

**Fix:** Check Railway logs for errors. Common causes:
- Missing `SETUP_PASSWORD` (required)
- Tailscale authkey invalid (check Tailscale admin)
- Volume mount failed (check Railway dashboard)

---

## Template Maintenance

### Updating the Template

1. Make changes to code
2. Test locally with Docker
3. Test on Railway (private project)
4. Push to GitHub
5. Railway auto-updates template (if configured)

### Monitoring

- **Railway Logs**: Check for deployment errors
- **GitHub Issues**: Track user-reported bugs
- **Tailscale Status**: Verify nodes connecting correctly

### Versioning

Consider tagging releases:

```bash
git tag -a v1.0.0 -m "Initial Railway template release"
git push origin v1.0.0
```

Railway can deploy from specific tags for stability.

---

## Support Channels

After publishing, provide support via:

1. **GitHub Issues**: [Your Repo Issues](https://github.com/maTheTrainee/openclaw-railway-template-tailscale-and-backup/issues)
2. **Railway Station**: Template discussion thread
3. **README.md**: Comprehensive troubleshooting section

---

## Example Template Submission

**Template Name:** OpenClaw + Tailscale

**Tagline:** Deploy OpenClaw AI assistant with private Tailscale access

**Description:**
```
1-click deployment of OpenClaw (AI coding assistant) with Tailscale integration.

Features:
â€¢ Web-based setup wizard (no CLI needed)
â€¢ Private access via Tailscale (optional HTTPS)
â€¢ Persistent state across redeploys
â€¢ Web terminal for OpenClaw TUI
â€¢ Supports Telegram, Discord, Slack channels

Perfect for teams wanting private, secure AI assistance without exposing services to the public internet.
```

**Category:** AI/ML

**Tags:** `ai`, `openai`, `anthropic`, `chatbot`, `tailscale`, `vpn`, `productivity`

**Code Repository:** `https://github.com/maTheTrainee/openclaw-railway-template-tailscale-and-backup`

**Demo URL:** _(Your test deployment)_

**Icon/Logo:** Tailscale + OpenClaw combined logo

---

## Final Checklist Before Submission

- [ ] `railway.json` valid and tested
- [ ] README.md has Deploy button and comprehensive docs
- [ ] Dockerfile builds without errors
- [ ] Health check passes
- [ ] Volume persists data
- [ ] Tailscale integration works
- [ ] All environment variables documented
- [ ] Secrets masked in logs
- [ ] Template tested end-to-end
- [ ] Support channels ready (GitHub Issues, README FAQ)

---

**Ready to publish?** ðŸš€

Go to [Railway Dashboard](https://railway.app/dashboard) â†’ Your Project â†’ Settings â†’ Template â†’ **Publish as Template**

---

**Questions?** Check:
- [Railway Template Docs](https://docs.railway.app/deploy/templates)
- [Railway Discord](https://discord.gg/railway)
- This repo's [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md)
